# 1. 第一章 计算机控制概述
计算机控制技术：是把计算机技术与自动化控制系统融为一体的一门综合性学问，是以计算机为核心部件的过程控制系统和运动控制系统。  
从计算机应用的角度出发，自动化控制工程是其重要的一个应用领域；
从自动化控制的领域来看，计算机技术又是一个主要的实现手段。
## 1.1. 计算机控制系统的组成
- 计算机控制系统是由常规仪表控制系统演变而来的;
- 常规仪表控制系统，一般分成闭环控制(图1-1a所示)与开环控制(图1-1b所示)两种结构形式;
	![|575](image/Pasted%20image%2020251124170942.png)
- 计算机控制系统：把控制器用控制计算机及 A/D（模/数）转换接口与 D/A（数/模）转换接口代替
	![|575](image/Pasted%20image%2020251124171008.png)

计算机控制系统的监控过程步骤：
1. 实时数据采集：对来自测量变送器的被控量的瞬时值进行采集和输入；
2. 实时数据处理：对采集到的被控量进行分析、比较和处理，按一定的控制规律运算，进行控制决策；
3. 实时输出控制：根据控制决策，适时地对执行器发出控制信号，完成监控任务；

计算机控制系统硬件一般包括（5）：
- 主机：CPU ＋ RAM ＋ ROM ＋ 系统总线
- 常规外部设备：输入/输出设备、外存储器等
- 过程输入输出通道：AI、AO、DI、DO
- 操作台：CRT、LED、LCD 等
- 通信设备：交换机、modem、集线器等
![|500](image/Pasted%20image%2020251124171210.png)

硬件仅为计算机控制系统的躯体。
软件：完成各种功能的计算机程序的总和，它是计算机控制系统的神经中枢，整个系统的动作都是在软件程序指挥下协调工作的。
软件通常分为系统软件和应用软件两大类

## 1.2. 控制系统分类
- 数据采集系统(Data Acquisition System)：是所有计算机控制系统的基础
- 操作指导控制系统(Operation Guide Control) ：基于数据采集系统的一种开环结构
- 直接数字控制系统（Direct Digital Control）：是用一台计算机完成对多个被控参数的数据采集，且按一定的控制规律进行实时决策，并通过输出通道发出控制信号以实现对生产过程的闭环控制。
- 监督计算机控制系统（Supervisory Computer Control）：是OGC系统与常规仪表系统或与DDC系统综合而成的两级系统。
- 分散控制系统（Distributed Control System）：是以微处理器为基础，借助于计算机网络对生产过程进行集中管理和分散控制的先进计算机控制系统。
- 现场总线控制系统（Fieldbus Control System）：是一种全数字化、全分散式、可互操作的和全开放式的新型控制系统。
- 计算机集成制造系统（Computer Integrated Manufacturing System）：是计算机技术、网络技术、自动化技术、信号处理技术、管理技术和系统工程技术等新技术发展的结果，它将企业的生产、经营、管理、计划、产品设计、加工制造、销售及服务等环节和人力、财力、设备等生产要素集成起来，进行统一控制，求得生产活动的最优化。

## 1.3. 控制装置种类
- 可编程控制器：简称可编程控制器PLC，是计算机技术与继电逻辑控制概念相结合的产物，其低端为常规继电逻辑控制的替代装置，而高端为一种高性能的工业控制计算机。
- 可编程调节器：又称单回路调节器、智能调节器、数字调节器。
- 总线式工控机：是基于总线技术和模块化结构的一种专用于工业控制的通用性计算机，一般称为工业控制计算机，简称为工业控制机或工控机。
- 嵌入式计算机系统：简称嵌入式系统，是以应用为核心，以计算机技术为基础，软件、硬件可裁剪，适应于应用系统对功能、可靠性、成本、体积、功耗等方面严格要求的专用计算机系统。嵌入性、专用性和计算机系统是嵌入式系统的三个基本要素。
- 其他控制装置，分散控制系统与现场总线控制系统，最初是以一种控制方案的形式出现的，但 很快受到工控市场的极大推崇，因而已经成为国内外自动化厂家争先推出的两种典型的装置，因为第1.2.5 节、第1.2.6节已经提及，本节不再赘述，详见第13章。

# 2. 第二章 模拟量输出通道
- 模拟量输出通道的任务：把计算机处理后的数字量信号转换成模拟量电压或电流信号，去驱动相应的执行器，从而达到控制的目的
- 模拟量输出通道(称为 D/A 通道或 AO 通道)构成：接口电路、数/模转换器(简称 D/A 或 DAC)、电压/电流变换器
- 模拟量输出通道基本构成：多D/A结构（图2-1(a)）和共享D/A结构（图中2-1(b)）
![|525](image/Pasted%20image%2020251123094413.png)
特点：
1、一路输出通道使用一个D/A转换器
2、D/A转换器芯片内部一般都带有数据锁存器
3、D/A转换器具有数字信号转换模拟信号、信号保持作用
4、结构简单，转换速度快，工作可靠，精度较高、通道独立
5、缺点是所需D/A转换器芯片较多

![|525](image/Pasted%20image%2020251123094602.png)
特点：
1、多路输出通道共用一个D/A转换器
2、每一路通道都配有一个采样保持放大器
3、 D/A转换器只起数字到模拟信号的转换作用
4、采样保持器实现模拟信号保持功能
5、节省D/A转换器，但电路复杂，精度差，可靠低、占用主机时间

## 2.1. D/A 转换器
### 2.1.1. 工作原理与性能指标
工作原理：B15

D/A转换器的性能指标：
1. 分辨率：是指 D/A 转换器能分辨的最小输出模拟增量，即当输入数字发生单位数码变化时所对应输出模拟量的变化量，它取决于能转换的二进制位数，数字量位数越多，分辨率也就越高。其分辨率与二进制位数n呈下列关系：
	$分辨率 = 满刻度值 /(2^n-1)= V_{REF} / 2^n$
2. 转换精度：是指转换后所得的实际值和理论值的接近程度
3. 偏移量误差：是指输入数字量时，输出模拟量对于零的偏移值
4. 线性误差：指 D/A 转换器偏离理想转换特性的最大偏差与满量程之间的百分比
5. 稳定时间：是描述D/A转换速度快慢的一个参数，指从输入数字量变化到输出模拟量达到终值误差1/2LSB时所需的时间

### 2.1.2. 8位DAC0832芯片
性能：
1. 一个8位D/A转换器
2. 电流输出方式
3. 稳定时间为1μs
4. 采用20脚双立直插式封装
5. 同系列芯片还有 DAC0830、DAC0831

原理、管脚：B16
### 2.1.3. 12位DAC1210芯片
DAC1210：一个12位D/A转换器，电流输出方式，其结构原理与控制信号功能基本类似于 DAC0832。由于它比 DAC0832多了4条数据输入线，故有24条引脚，DAC 1210内部原理框图如图2-4所示，其同系列芯片DAC1208、DAC1209可以相互代换

原理：B17
## 2.2. 接口电路
作用：为使主机能向 D/A 转换器传送数据，进行地址译码、产生片选信号或写信号
B19
## 2.3. 输出方式
多数D/A转换芯片输出的是弱电流信号，要驱动后面的自动化装置，需在电流输出端外接运算放大器。

电压输出方式：
B21
1. 单极性输出
2. 双极性输出：$A_2$ 将运算放大器 $A_1$ 的单项输出变为双向输出

电流输出方式：
因为电流信号易于远距离传送，且不易受干扰，特别是在过程控制系统中，自动化仪表只接收电流信号，所以在微机控制输出通道中常以电流信号来传送信息，这就需要将电压信号再转换成电流信号，完成电流输出方式的电路称为V/I变换电路
1. 普通运放 V/I 变换电路
2. 集成转换器 V/I 变换电路
3. 自动 / 手动输出方式：（1） 自动/手动状态下的V/I变换（2）自动/手动双向无扰动切换

## 2.4. D/A转换模板
通用性：
1. 符合总线标准：总线是指计算机内部的总线结构，以便设计者在组合计算机控制系统硬件时, 只需往总线插槽上插上选用的功能模板而无需连线
2. 接口地址可选：一套控制系统往往需配置多块功能模板，或者同一种功能模板可能被组合在不同的系统中。因此，每块模板应具有接口地址的可选性
	基址(或称板址)和片址(或称口址)组成
3. 输出方式可选：为了适应不同控制系统对执行器的不同需求，D/A转换模板往往把各种电压输出和电流输出方式组合在一起，然后通过短接柱来选定某一种输出方式

D/A 转换模板的设计原则：
1. 安全可靠：尽量选用性能好的元器件，并采用光电隔离技术。
2. 性能/价格比高：既要在性能上达到预定的技术指标，又要在技术路线、芯片元件上降低成本。
3. 通用性：D/A转换模板应符合总线标准，其接口地 址及输出方式应具备可选性。

D/A转换模板的设计步骤：
1. 确定性能指标
2. 设计电路原理图
3. 设计和制造印制线路板
4. 最后焊接和调试电路板

# 3. 第三章模拟量输入通道
模拟量输入通道的任务：转换——模拟量到数字量的转换。
组成核心：A/D转换器
![|600](image/Pasted%20image%2020251123163322.png)
## 3.1. 信号调理电路
在控制系统中，对被控量的检测往往采用各种类型的测量变送器，当它们的输出信号为0 - 10 mA或4 -20 mA的电流信号时，一般是采用电阻分压法把现场传送来的电流信号转换为电压信号，以下是两种变换电路：
1. 无源I/V变换
	构成：无源器件电阻＋RC滤波＋二极管限幅等实现
	取值:  
	 输入0- 10 mA，输出为0 -5 V ，R1=100Ω，R2=500Ω
	 输入4 -20 mA，输出为1 - 5 V，R1=100Ω，R2=250Ω；
	 ![|211](image/Pasted%20image%2020251123163820.png)
2. 有源I/V变换
	构成：运算放大器＋电阻电容组成
	电路放大倍数：同相放大电路
	取值：
	 R1=200Ω，R3=100kΩ，R4=150kΩ 输入0 ~ 10 mA输出0 ~ 5 V
	 R1=200Ω，R3=100kΩ，R4=25kΩ 输入4 ~ 20 mA输出1 ~ 5 V
	 ![|257](image/Pasted%20image%2020251123164016.png)
## 3.2. 多路模拟开关
构成：电平转换、译码驱动及开关电路三部分组成
![|425](image/Pasted%20image%2020251123164422.png)
扩展电路：
![|475](image/Pasted%20image%2020251123164531.png)

## 3.3. 前置放大器
前置放大器的任务：将输入模拟小信号放大到A/D转换的量程范围，如0-5VDC
![|550](image/Pasted%20image%2020251123164910.png)
1. 测量放大器：对称结构，可抑制共模干扰
2. 可变增益放大器
## 3.4. 采样保持器
采样过程：以一定时间间隔对连续信号进行采样，使连续信号转换为时间上离散、幅值上连续的脉冲序列的过程
零阶采样保持器：在两次采样的时间间隔内，根据采样信号而复现原信号的装置
![|525](image/Pasted%20image%2020251123165422.png)
构成：输入输出缓冲放大器A1、A2和采样开关S、保持电容CH。
工作过程：采样期间，开关S闭合，输入电压VIN通过A1对CH快速充电，输出电压VOUT跟随VIN变化；保持期间，开关S断开，由于A2的输入阻抗很高，理想情况下电容CH将保持电压VC不变，因而输出电压VOUT=VC也保持恒定。

零阶集成采样保持器
## 3.5. A/D转换器
1. 逐位逼近式A/D转换原理
![|525](image/Pasted%20image%2020251123170116.png)
2. 双积分式A/D转换原理
3. 电压/频率式A/D转换原理

A/D转换器的性能指标：
- 分辨率
	分辨率是指A/D转换器对微小输入信号变化的敏感程度。分辨率越高，转换时对输入量微小变化的反应越灵敏。通常用数字量的位数来表示，如8位、10位、12位等。分辨率为n，表示它可以对满刻度的1/ $2^n$ 的变化量作出反应。即：分辨率 = 满刻度值 / $2^n$
- 转换精度
	用绝对误差和相对误差来表示。
	绝对误差＝实际模拟量输入值－理论值
	绝对误差包括增益误差，零点误差和非线性误差等。
	相对误差: (指绝对误差/满刻度值) X 100%
	对A/D转换器常用最低有效值的位数LSB（Least Significant Bit）来表示，1LSB = 1/ $2^n$ 。
	例如，对于一个8位0~5V的A/D转换器，如果其相对误差为±1LSB，则其绝对误差为±19.5 mV，相对百分误差为0.39％。一般来说，位数n越大，其相对误差（或绝对误差）越小。
- 转换时间
	 A/D转换器完成一次转换所需的时间称为转换时间。如逐位逼近式A/D 转换器的转换时间为微秒级，双积分式A/D转换器的转换时间为毫秒级
- 线性误差
	A/D转换器实际转换特性曲线与理想特性曲线之间的最大偏差。在转换器设计中，一般要求非线性误差不大于1/2LSB。通常用非线性误差来表示A/D转换器的线性度

ADC0809芯片介绍：B41
ADC0809接口电路：
A/D转换器的接口电路主要是解决主机如何分时采集多路模拟量输入信号的，即主机如何启动A/D转换（体现为对START和ALE引脚的控制），如何判断A/D完成一次模数转换（体现为是否读取EOC标志，如何读取），如何读入并存放转换结果的。

1. 查询方式读A/D转换数
	![|550](image/Pasted%20image%2020251123171450.png)
	非与门02（3）、/IOW控制A/D转换启动；
	通过三态缓冲器读入EOC状态以判断是否转换结束
2. 定时方式读A/D转换数
	![|550](image/Pasted%20image%2020251123171713.png)
这两种方法的共同点：
- 上面两种方法硬软件接口简单，但在转换期间独占了CPU时间，好在这种逐位逼近式A/D转换的时间只在微秒数量级。
- 当选用双积分式A/D转换器时，因其转换时间在毫秒级，因此采用中断法读A/D转换数的方式更为适宜。
- 因此，在设计数据采集系统时，究竟采用何种接口方式要根据A/D转换器芯片而定。

AD574A芯片及其接口电路：B45

## 3.6. A/D转换模板
1. A/D转换模板也需要遵循I/O模板的通用性原则：符合总线标准，接口地址可选以及输入方式可选。
	输入方式可选主要是指模板既可以接受单端输入信号也可以接受双端差动输入信号。
2. A/D转换模板结构组成
	1. I/O电气接口：完成电平转换、滤波、隔离等信号调理作用；
	2. I/O功能部分：实现采样、放大、模/数转换等功能，
	3. 总线接口：完成数据缓冲、地址译码等功能。
B48
# 4. 数字量输入输出通道
**不重要、基本概念**
在微机控制系统中，除了要处理模拟量信号以外，还要处理数字信号，包括开关信号、脉冲信号。如开关触点的闭合和断开,指示灯的亮和灭，继电器或接触器的吸合和释放，马达的启动和停止，晶闸管的通和断，阀门的打开和关闭，仪器仪表的 BCD 码，以及脉冲信号的计数和定时等等。
## 4.1. 光电耦合隔离技术
为了防止现场的电磁干扰通过输入、输出通道串入到计算机系统中，利用光信号的传送不受电磁场的干扰完成隔离功能
按输出级不同分为：三极管型、单向晶闸管型、双向晶闸管型

光电耦合隔离电路：
分类：数字量同相传递与数字量反相传递两种
1. 同相传递：光耦的输入输出同相，即输入为低（高）输出为低（高）
2. 反相传递：光耦的输入输出反相，即输入为高（低）输出为低（高）

## 4.2. 数字量输入通道
数字量输入通道简称 DI 通道。
任务：是把生产过程中的数字信号转换成计算机易于接受的形式
信号调理电路：虽然都是数字信号，不需进行A/D转换，但对通道中可能引入的各种干扰必须采取相应的技术措施，即在外部信号与单片机之间要设置输入信号调理电路

在开关输入电路中，主要考虑：  
1. 电平转换：用电阻分压法把电流信号转换为电压信号。  
2. RC滤波：用 RC 滤波器滤出高频干扰。  
3. 过电压保护：用稳压管和限流电阻作过电压保护；用稳压管或压敏电阻把瞬态尖峰电压箝位在安全电平上。  
4. 反电压保护：串联一个二极管防止反极性电压输入。  
5. 光电隔离：用光耦隔离器实现计算机与外部的完全电隔离。

脉冲计数电路

## 4.3. 数字量输出通道
数字量输出通道简称 DO 通道。
- 任务：把计算机输出的微弱数字信号转换成能对生产过程进行控制的数字驱动信号。
- 常用电路：三极管驱动电路、继电器输出驱动电路、晶闸管输出驱动电路、固态继电器输出驱动电路等。
- 选择：根据现场负荷的不同，如指示灯、继电器、接触器、电机、阀门等，可以选用不同的功率放大器件构成不同的开关量驱动输出通道

三极管驱动电路：
对于低压情况下的小电流开关量，用功率三极管就可作开关驱动组件，其输出电流就是输入电流与三极管增益的乘积
1. 普通三极管驱动电路           
2. 达林顿驱动电路
	- 应用场合：当驱动电流需要达到几百毫安时，如驱动中功率继电器、电磁开关等装置，输出电路必须采取多级放大或提高三极管增益的办法。
	- 构成：多对两个三极管组成的达林顿复合管构成
	- 特点：具有高输入阻抗、高增益、输出功率大及保护措施完善的特点，同时多对复合管适用于计算机控制系统中的多路负荷

继电器驱动电路

晶闸管驱动电路
- 分类：单向晶闸管、双向晶闸管
- 结构：阳极A、阴极K、控制极（门极）G三个极

固态继电器驱动电路
固态继电器SSR（Solid State Relay）：是一种新型的无触点开关的电子继电器，它利用电子技术实现了控制回路与负载回路之间的电隔离和信号耦合，而且没有任何可动部件或触点，却能实现电磁继电器的功能。
优点：体积小、开关速度快、无机械噪声、无抖动和回跳、寿命长。

## 4.4. DI/DO模板
DI 模板 / DO 模板：把数字量输入通道或数字量输出通道设计在一块模板上，也可统称为数字量 I/O 模板
组成：PC 总线接口逻辑、I/O 功能逻辑、I/O 电气接口
![|575](image/Pasted%20image%2020251123114904.png)

# 5. 第五章键盘及其接口技术
**工作原理（矩阵式：阐述扫的方法）、抖动解决**
- 键盘：一种最常用的输入设备,它是一组按键的集合，
- 分类：从功能上可分为数字键和功能键两种，作用是输入数据与命令，查询和控制系统的工作状态，实现简单的人机对话。
- 键盘接口电路
	- 编码键盘：采用硬件编码电路来实现键的编码，每按下一个键，键盘便能自动产生按键代码。编码键盘主要有BCD码键盘、ASCII码键盘等类型。
		特点：使用方便，键盘码产生速度快，占用CPU时间少，但对按键的检测与消除抖动干扰是靠硬件电路来完成的，因而硬件电路复杂、成本高。
	- 非编码键盘：仅提供按键的通或断状态，按键代码的产生与识别由软件完成。
		特点：硬件电路简单，成本低，但占用CPU的时间较长。

## 5.1. 键盘输入电路
![|500](image/Pasted%20image%2020251123115432.png)
按键的抖动干扰：由于机械触点的弹性振动，按键在按下时不会马上稳定地接通，在弹起时也不能一下子完全地断开，因而在按键闭合和断开的瞬间均会出现一连串的抖动

去抖动的方法：
1. 硬件方法（编码键盘）：设计一个滤波延时电路或单稳态电路
2. 软件方法（非编码键盘）：编制一段时间大于100ms的延时程序

## 5.2. 非编码独立式键盘
非编码独立式键盘：每个按键独立地占有一根 I/O 接口线，通过 CPU 对相关 I/O 接口状态的检测来确定按键按下
查询法接口电路：
![|550](image/Pasted%20image%2020251123144536.png)
实现的功能：查询检测是否有键按下，如有键闭合，则消除抖动，再判断键号，然后转入相应的键处理。
占用 CPU 时间较多：CPU 每隔一定时间主动地去扫描按键一次，扫描时间间隔应小于两次按键的时间间隔，否则会有按键不响应的情形

中断法接口电路：
![|450](image/Pasted%20image%2020251123144908.png)

## 5.3. 非编码矩阵式键盘
矩阵式键盘又叫行列式键盘，是用I/O口线组成的行、列矩阵结构，在每根行线与列线的交叉处，二线不直接相通而是通过一个按键跨接接通。采用这种矩阵结构只需M根行输出线和N根列输入线，就可连接M×N个按键。通过键盘扫描程序的行输出与列输入就可确认按键的状态，再通过键盘处理程序便可识别键值。
识别方法（列线的电平取决于该键所在的行线）：
- 行扫描法：逐行零扫描查询法
	1. 逐行输出行扫描信号“0”，使各行依次为低电平，然后分别读入列数据，检查此（低电平）行中是否有键按下
	2. 如果某列线为低电平，则表示此（低电平）行线与此列线的交叉处有键按下，在对该键进行译码计算出键值，然后转入该键的功能子程序入口地址
	3. 如果没有任何一根列线为低电平，则说明此（低电平）行没有键按下
	4. 接着进行下一行的“0”行扫描与列读入，直到 8 行全部检查完为止，若无键按下则返回
- 线反转法：
	为了迅速判断按键中是否有键按下：
	- 将全部行线同时设置为低电平，然后检测列线的电平状态
	- 若所有列线均为高电平，则说明键盘中无键按下，立即返回
	- 若有一列的电平为低，则表示键盘中有键按下，然后再进行逐行扫描
计算机键盘程序设计:
- 实时性、消除抖动干扰
- 选用编程扫描、定时扫描或中断扫描。

## 5.4. 编码键盘
1. 二进制编码器
2. 编码键盘接口电路

# 6. 显示器及其接口技术
**LED：给电路，显示东西，阐述过程**
显示装置：主要用来显示生产过程的工艺状况与运行结果
常用的显示器件：
- 显示记录仪：是以模拟方式连续显示和记录过程参数的动态变化，但其价格都很贵，在目前的计算机控制系统中已很少采用。
- LED数码管：具有结构简单、体积小、功耗低、配置灵活、显示清晰、可靠性高等优点，已被微型计算机控制系统及智能化仪表广泛采用。
- LCD：则以其功耗极低的特点，占据了从电子表到计算器，从袖珍仪表到便携式微型计算机等应用场合。
- CRT终端： CRT终端以其图文并茂的直观生动画面，可以显示生产过程中的各种画面及报表，如生产流程图、显示报警图、趋势曲线图、路查询图等,在很多微型计算机控制系统中，特别在DDC，SCC以及DCS控制系统中，大都采用CRT操作台进行监视和控制。

## 6.1. LED 显示器工作原理
LED：（Light Emitting Diode的英文缩写）,是利用PN结把电能转换成光能的固体发光器件，根据制造材料的不同可以发出红、黄、绿、白等不同色彩的可见光来。
伏安特性：类似普通二极管，正向压降约为2伏左右，工作电流一般在10 -20 mA。
结构形式：单段的圆形或方形LED常用来显示设备的运行状态，8段LED可以显示各种数字和字符。

### 6.1.1. LED 显示器工作原理
8段LED显示器：
共阴极：发光管的阴极并接成公共端COM，加高电平灯亮;
共阳极：发光管的阳极并接成公共端COM，加低电平灯亮.
实现方法：CPU的数据线与LED各段引脚相连，控制输出的数据，点亮8段LED不同段的组合，显示等十六进制数。

### 6.1.2. LED显示器显示方式
在计算机控制系统中，常利用n个LED显示器构成n位显示。通常把点亮LED某一段的控制称为段选，而把点亮LED某一位的控制称为位选或片选。
显示方式（根据 LED 显示器的段选线、位选线与控制端口的连接方式不同）：
1. 静态显示方式（**B74：工作流程**）
	![|425](image/Pasted%20image%2020251123202718.png)
	结构特点：
	- 无位选：4个COM端连接在一起并接地
	- 段选独立：每个LED的段选各自与一个8位并行 I/O 口（具有锁存功能，对某个 LED 输出一次段选码之后，能一直保持显示结果）相连
	工作特点：
	- 缺点是电路中占用I/O口资源多；
	- 优点是占用CPU机时少，显示稳定可靠
	适用：规模较大的实时控制系统。
2. 动态显示方式（**B75：工作流程**）
	![|550](image/Pasted%20image%2020251123202845.png)
	结构特点：
	- 4个LED显示器各自的段选线连在一起，与一个8位的I/O口相连
	- 各自的COM端则由另一个I/O口进行位选
	工作特点：
	- 优点是占用I/O资源少，线路简单、硬件成本低，功耗低
	- 缺点是需用软件程序不断地循环扫描定时刷新，因而占用了CPU的大多数机时。
	适用：小型测控系统

### 6.1.3. LED显示器接口电路
1. 静态接口电路
	整个显示部分正常工作必须有：显示部分、锁存器、译码、驱动电路。
	锁存、译码、驱动均由硬件实现——CD4511B。
	实现过程：74LS138输出作为LED片选，每两个共用一个片选；每两个段选码共用一个字节
2. 动态显示接口电路
	锁存、驱动由硬件电路实现；
	段选码的译码由软件实现。
	实现过程：各个LED段选线对应并接到一片8D触发器74LS374（U1）进行段选控制，其间串有8个三极管以正向驱动LED的阳极；各个LED的COM端由另一片 74LS374（U2）进行位选控制，其间接有达林顿阵列驱动器MC1413（内含7对复合三极管）对阴极进行反向驱动；74LS138：控制位选和段选的锁存器74LS374，Y0=0,锁存CPU输出的段选码；

## 6.2. 图形显示器
两种：CRT显示器、TFT平面显示器
1. CRT 显示器：由一个图形监示器和相应的控制电路组成。在工业计算机中，插入一块VGA/TVGA图形控制板即可实现功能很强的图象显示功能。
	- 优点：丰富的画图命令：如点、线、矩形、多边形、圆、弧以及区域填充、拷贝、剪裁等操作还有窗口功能等
	- 缺点：体积与功耗大，易受振动和冲击，容易受射线辐射、磁场干扰，因此在恶劣工况下须采用特殊加固和屏蔽措施。
2. TFT显示器
	- 体积小，耗电省，如最薄的壁挂式机型厚度仅为5cm(2in)；
	- 可靠性高，寿命长，不易受振动、冲击和射线的干扰影响；
	- 显示颜色256种基色，可扩展至25600种组合。

图形显示器作用：直观形象地监视和操作工业生产过程。
显示画面功能：反映出整个生产的工艺流程，便于单元操作控制；要有实时动态数据，又要有历史记忆功能。
显示画面功能内容：调节器、指示仪、记录仪、报警仪、模拟屏以  及开关按钮、指示灯等。
设计语言：早期用汇编语言来编写，后来多采用高级语言，现在采用组态软件，诸如美国的Intouch、Fix和德国的  Wincc，国内的组态王、力控、MCGS和Controx等。
常用的显示画面：有总貌画面、分组画面、点画面、流程图画面、趋势曲线画面、报警显示画面、操作指导画面等

# 7. 第七章 数据处理技术
数据采集：在计算机控制系统中，是最基本的一种模式。一般是通过传感器、变送器把生产过程的各种物理参数转换成电信号，然后经A/D通道或DI通道，把数字量送入计算机中。
数据处理：计算机在对这些数字量进行显示和控制之前，还必须根据需要进行相应的数值计算即数据处理。为了满足不同系统的需要，设计出了许多有效的数据处理技术方法，如预处理，数字滤波，标度变换，查表和越限报警等。

## 7.1. 测量数据预处理技术
### 7.1.1. 系统误差的自动校准
系统误差：在控制系统的测量输入通道中，一般均存在放大器等器件的零点偏移和漂移，会造成放大电路的增益误差及器件参数的不稳定等现象。
特点：是在一定的测量条件下，其变化规律是可以掌握的，产生误差的原因一般也是知道的。
处理方法：通过适当的技术方法如数字调零、系统校准来确定并加以校正的，一般采用软件程序进行处理。

1. 数字调零
	数字调零：处理由零点偏移造成系统误差，通过软件实现
	电路：多路开关、前置放大器、A/D转换器、CPU
	原理：CPU分时巡回采集1路至n路电压信号。
	1. 寻找零点偏移值：第0 路为校准信号即接地信号，理论上电压＝0，CPU采样值＝零，而实际上产生了一个不等于零的数值，此值零点偏移值N0；
	2. 然后依次采集1、2、… n路，采样值N1、N2、… Nn值就是实际值＋零点偏移值N0。计算机要进行的数字调零恢复本次测量的实际值＝（Ni- N0）。
	特点：此方法，可去掉放大电路、A/D转换电路本身的偏移及随时间与温度而发生的各种漂移的影响，从而大大降低对这些电路器件的偏移值的要求，降低硬件成本。
	缺点：不能校正由传感器本身引入的误差。
2. 系统校准
	原因：克服由传感器本身引入的误差。
	系统校准计算：
		VR ：标准输入信号；
		NR： VR对应采样值
		V：实际被测输入信号；
		N： V对应采样值
		$V=\frac{V_R}{N_R}N$
	适用场合：传感器特性随时间会发生变化的场合

### 7.1.2. 数据字长的预处理
1. 输入位数大于输出位数
	处理方法：忽略高位数的最低几位。
	如：10位A/D转换器的输入值为0011111010，此值经处理后送入8位D/A转换器的值就变为00111110。这在计算机中通过向右移位的方法是很容易实现的。
2. 输入位数小于输出位数
	处理方法：将8位数左移两位构成10位数，最低两位用“0”填充
	如：转换前的8位输入值为：××××××××；
	转换后的10位输出值为：××××××××00。

## 7.2. 数字滤波方法
|           | 名称          | 原理/算法                                                                                                                                                                                                                                                                                                                                                 | 适用场合                                                                       |
| --------- | ----------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------- |
|           | **算数平均滤波**  | 算术平均滤波是在采样周期 T 内,对测量信号 y 进行 m 次采样,把 m 个采样值相加后的算术平均值作为本次的有效采样值<br>即：$\bar{y}(k)=\frac{1}{m}\sum_{i=1}^{m}y_{i}$                                                                                                                                                                                                                                        | 适用于周期性干扰的信号滤波。                                                             |
| **平均值滤波** | **去极值平均滤波** | 去极值平均滤波是对连续采样的 m 个数据进行比较,去掉其中的最大值与最小值,然后计算余下的 m-2 个数据的算术平均值。<br>缺点：灵敏度和平滑度较差                                                                                                                                                                                                                                                                          | 适用于工业场合经常遇到尖脉冲干扰的信号滤波。                                                     |
|           | **加权平均滤波**  | 对每次采样值不以相同的权系数而以增加新鲜采样值的权重相加。<br>$\bar{y}(k)=\sum_{i=1}^{m}C_{i}y_{i}$                                                                                                                                                                                                                                                                                | 这种算法能协调系统平滑度和灵敏度的矛盾,提高灵敏度,更适用于纯滞后较大的对象。                                    |
|           | 滑动平均滤波      | 滑动平均波是在每个采样周期只采样一次,将这一次采样值和过去的若干次采样值一起求平均,所得结果即为有效采样值。<br>优势：实时性好,提高了系统的响应速度                                                                                                                                                                                                                                                                          | 前三种的平均滤波算法有一个共同点：即每取得一个有效采样值必须连续进行若干次采样。系统的采样速度较慢或采样信号变化较快时，系统的实时性就无法得到保证。 |
|           | 中值滤波        | 将信号y 的连续m次采样值按大小进行排序，取其中间值作为本次的有效采样值。本算法为取中值，故采样次数 m 应为奇数，一般3~5次即可<br>编制中值滤波的算法程序：首先把m个采样值从小到大（或从大到小）进行排队，这可采用几种常规的排序算法如冒泡算法，然后再取中间值                                                                                                                                                                                                                  | 中值滤波对缓变过程中的偶然因素引起的波动或采样器不稳定造成的误差所引起的脉动干扰比较有效，而对快速变化过程(如流量)的信号采样则不适用        |
|           | 限幅滤波        | 限幅滤波就是把两次相邻的采样值相减,求其增量的绝对值，再与两次采样所允许的最大差值 $\Delta Y$ 进行比较,如果小于或等于 $\Delta Y$,表示本次采样值 y(k) 是真实的,则取 y(k) 为有效采样值;反之,y(k)是不真实的，则取上次采样值 y(k-1)作为效采样值。<br>$\Delta Y$：相邻两次采样值所允许的最大偏差，其大小取决于控制系统采样周期T和信号Y的正常变化率。<br>$$\left\{\begin{array}{ll} \|y(k)-y(k-1)\| \leqslant \Delta Y, & y(k)=y(k) \\\|y(k)-y(k-1)\|>\Delta Y, & y(k)=y(k-1)\end{array}\right.$$ | 对随机干扰或采样器不稳定引起的失真有良好的滤波效果。                                                 |
|           | 惯性滤波        | 惯性滤波是模拟硬件 RC 低通滤波器的数字实现。常用的 RC 滤波器的传递函数为<br>Tf=RC：滤波器的滤波时间常数，其大小直接关系到滤波效果。一般说来， Tf 越大，则滤波器的截止频率（滤出的干扰频率）越低，滤出的电压纹波较小,但输出滞后较大。<br>实现方法：由于高精度的RC电路不易制作，所以硬件RC 滤波器不可能对极低频率的信号进行滤波。为此，用软件做成低通数字滤波器，从而实现一阶惯性的数字滤波<br>$\frac{Y(s)}{X(s)}=\frac{1}{1+T_fs}$                                                                                                  | 显然,该算法比较简单,比起平均值波波法要快，能很好地消除周期性干扰和较宽频率的随机于扰信号。                             |

## 7.3. 标度变换算法
标度：衡量某种物理量或参数的量纲；
变换：从一种物理量转换为另一种物理量；
标度变换：即把计算机系统检测的对象参数的二进制数值还原变换为原物理量的工程实际值。

标度变换方法：线性式变换、非线性式变换、多项式变换查表法
方法选择依据：被测参数的工程量与转换后数字量间的函数关系；  
通常传感器的输入输出特性决定了此函数关系，从而决定标度变换方法。

1. 线性式变换
	线性标度变换：最常用的标度变换方式
	前提条件：传感器输出信号与被测参数间呈线性关系
2. 非线性式变换
	条件：传感器的输出信号与被测参数之间呈非线性关系,但函数关系可用解析式来表示。
3. 多项式变换
	- 适用场合：传感器输出信号与被测参数间呈非线性关系
	- 应用条件：非线性函数关系不可用解析式来表示
	- 采用方法：插值多项式来进行标度变换
	插值多项式原理 B102
	- 插值法缺点：
		- 逼近精度影响－很大影响。
		- 处理方法－通常在函数y= f( x )的曲线上曲率大的地方应适当加密插值点。
		- CPU影响－增加插值点和多项式的次数能提高逼近精度
	- 较好的方法：采用分段插值法
### 7.3.1. 查表法
查表法：就是把事先计算或测得的数据按照一定顺序编制成表格
查表程序的任务：就是根据被测参数的值或者中间结果，查出最终所需要的结果。
具体的查表方法：顺序查表法，计算查表法，对分搜索法等。

1. 顺序查表法
	针对无序排列表格的一种方法。其查表方法类似人工查表。因为无序表格中所有各项的排列均无一定的规律，所以只能按照顺序从第一项开始逐项寻找，直到找到所要查找的关键字为止。顺序查表法虽然比较“笨”，但对于无序表格或较短表格而言，仍是一种比较常用的方法。
2. 计算查表法
	根据所给的数据元素Xi ，通过一定的计算，求出元素Xi所对应的数值的地址，然后将该地址单元的内容取出即可。
	这种有序表格要求各元素在表中的排列格式及所占用的空间必须一致，而且各元素是严格按顺序排列。其关键在于找出一个计算表地址的公式，只要公式存在，查表的时间与表格的长度无关。正因为它对表格的要求比较严格，并非任何表格均可采用。通常它适用于某些数值计算程序、功能键地址转移程序以及数码转换程序等。
3. 对分查表法
	先取数组的中间值D=n/2进行查找，与要搜索的X值进行比较，若相等，则查到。对于从小到大的顺序来说，如果X＞n/2项，则下一次取n/2-n间的中值，即3n/4与X进行比较；若X＜n/2项，则取0~n/2的中值，即n/4与X进行比较。如此比较下去，则可逐次逼近要搜索的关键字，直到找到为止。

## 7.4. 越限报警处理
上限报警：若XK ＞ XH则发出上限报警，否则继续执行原定操作。
下限报警：若XK ＜ XL ，则下限报警，否则继续执行原定操作。
上下限报警：若XK ＞ XH，则上限报警，否则判断XK ＜ XL否？若是则下限报警，否则继续执行原定操作。
具体设计报警程序时，为了避免测量值在极限值一点处来回摆动造成频繁报警，一般应在极限值附近设置一个回差带
![|525](image/Pasted%20image%2020251123211550.png)
报警方式：
- 普通声光报警
- 模拟声光报警
- 语音报警

# 8. 抗干扰技术
计算机控制系统的被控变量分布在生产现场的各个角落，因而计算机是处于干扰频繁的恶劣环境中，干扰是有用信号以外的噪声，这些干扰会影响系统的测控精度，降低系统的可靠性，甚至导致系统的运行混乱，造成生产事故。
但干扰是客观存在的，所以，人们必须研究干扰，以采取相应的抗干扰措施。本章主要讨论干扰的来源、传播途经及抗干扰的措。
## 8.1. 干扰的来源与传播途径
干扰的来源：
1. 外部干扰
2. 内部干扰：由系统的结构布局、制造工艺所引入的

干扰的传播途径：静电耦合，磁场耦合，公共阻抗耦合

## 8.2. 硬件抗干扰措施
在硬件抗干扰措施中，除了按照干扰的三种主要作用方式——串模、共模及长线传输干扰来分别考虑外，还要从布线、电源、接地等方面考虑。
### 8.2.1. 串模干扰的抑制
串膜干扰：叠加在被测信号上的干扰噪声，即干扰源串联在信号源回路中
1. 双绞线做信号引线
	双绞线抗干扰原因：外界电磁场会在双绞线相邻的小环路上形成相反方向的感应电势，从而互相抵消减弱干扰作用。
	应用场合：可用来传输模拟信号和数字信号，用于点对点连接和多点连接应用场合，传输距离为几公里，数据传输速率可达2Mbps
2. 引入滤波电路
	硬件滤波器分类：低通、高通、带通等滤波器。
	低通滤波器：适用干扰频率比被测信号频率高；
	高通滤波器：干扰频率比被测信号频率低；
	带通滤波器：干扰频率落在被测信号频率的两侧；
	实现电路：采用电阻R、电容C、电感L等构成滤波器；

### 8.2.2. 共模干扰的抑制
抑制方法：有变压器隔离、光电隔离与浮地屏蔽等三种措施
1. 变压器隔离
	![|475](image/Pasted%20image%2020251123221747.png)
2. 光电隔离
	![|575](image/Pasted%20image%2020251123221821.png)
3. 浮地屏蔽
	![|525](image/Pasted%20image%2020251123222020.png)
### 8.2.3. 长线传输干扰的抑制
1. 波阻抗的测量
2. 终端阻抗匹配
3. 始端阻抗匹配

### 8.2.4. 信号线的选择与敷设
1. 信号线的选择
2. 信号线的敷设
	信号线的敷设要注意以下事项：
	- 模拟信号线与数字信号线不能合用同一根电缆，要绝对避免信号线与电源线合用同一根电缆。
	- 屏蔽信号线的屏蔽层要一端接地，同时要避免多点接地。
	- 信号线的敷设要尽量远离干扰源，如避免敷设在大容量变压器、电动机等电器设备的附近
	- 信号电缆与电源电缆必须分开，并尽量避免平行敷设

### 8.2.5. 电源系统的抗干扰
计算机控制系统一般是由交流电网供电，电网电压与频率的波动将直接影响到控制系统的可靠性与稳定性。电源的干扰是计算机控制系统的一个主要干扰，抑制这种干扰的主要从以下2个方面考虑：
1. 交流电源系统
2. 直流电源系统
	- 交流电源变压器的屏蔽
	- 采用直流开关电源
	- 采用DC-DC变换器
	- 为每块电路板设立独立的直流电源
	- 集成电路块的VCC加旁路电容

### 8.2.6. 接地系统的抗干扰
计算机控制系统中的地线：数字地、系统地、交流地、模拟地、保护地
接地处理
1. 单点接地与多点接地
2. 分别回流法单点接地
3. 输入系统的接地
4. 印制线路板的地线分布
	 设计印制线路板应遵守下列原则，以免系统内部地线产生干扰。
	1. TTL，CMOS器件的地线要呈辐射状，不能形成环形。
	2. 印制线路板上的地线要根据通过的电流大小决定其宽度，不要小于3mm，在可能的情况下，地线越宽越好。
	3. 旁路电容的地线不能长，应尽量缩短。
	4. 大电流的零电位地线应尽量宽，而且必须和小信号的地分开。
5. 主机系统的接地
	1. 全机一点接地
	2. 外壳接地机芯浮空
	3. 多机系统的接地

## 8.3. 软件抗干扰措施
- 在控制系统的输入输出通道中，采用数字滤波方法，即采用某种计算方法对通道的信号进行数字处理，以削弱或滤除干扰噪声
- 而对于那些可能穿过通道而进入CPU的干扰，可采取指令冗余、软件陷阱以及程序运行监视等措施来使CPU恢复正常工作。

指令冗余技术:
要解决的问题：程序跑飞
- 解决方法：采用指令冗余技术
- 原则：在对程序流向起决定作用的指令之前以及影响系统工作状态的重要指令之前都应插入两、三条NOP指令，还可以每隔一定数目的指令插入NOP指令，以保证跑飞的程序迅速纳入正确轨道。
- 优点：指令冗余技术可以减少程序出现错误跳转的次数

软件陷阱技术：
- 软件陷阱：在非程序区设置拦截措施，使程序进入陷阱，即通过一条引导指令，强行将跑飞的程序引向一个指定的地址， 
- 举例若我们把这段程序的入口标号称为ERROR的话，软件陷阱即为一条JMP ERROR指令。软件陷阱是由3条指令构成：
	NOP
	NOP
	JMP ERROR

## 8.4. 程序运行监视系统
Watchdog Timer工作原理：
![|500](image/Pasted%20image%2020251124143714.png)

Watchdog Timer实现方法：
![|375](image/Pasted%20image%2020251124143811.png)



1. 概念
2. DA 原理、参数性能指标、给电路分析、地址分析电路（片选信号、译码器功能）、电路操作（简单的）
3. 设计电路
4. 没东西（几乎不考）、基础概念
5. 键盘：工作原理、矩阵式、扫法、解决方式、汇编程序不要求（用文字阐述）
6. 显示器：LED 考，显示、要怎么显示（步骤阐述）、LCD 不考
7. 数据处理：数学计算（滤波方法），概念（线性标度）
8. 抗干扰：考，阐述问答，软件抗干扰（特点概念），引入会不会跑飞
9. 第九章：pid 控制，pid 感性特点概念

